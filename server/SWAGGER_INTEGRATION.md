# Swagger OpenAPI é›†æˆæ–‡æ¡£

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆ Swagger OpenAPI 3.0 æ–‡æ¡£æ¡†æ¶ï¼Œä¸ºæ‰€æœ‰ 12 ä¸ª API è·¯ç”±æä¾›å®Œæ•´çš„äº¤äº’å¼æ–‡æ¡£ã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²é›†æˆçš„è·¯ç”± (12ä¸ª)

#### å…¬å¼€è·¯ç”± (7ä¸ª)
1. **GET /** - å¥åº·æ£€æŸ¥
2. **POST /api/users/register** - ç”¨æˆ·æ³¨å†Œ
3. **POST /api/users/verify** - é‚®ç®±éªŒè¯
4. **POST /api/users/login** - ç”¨æˆ·ç™»å½•
5. **GET /api/pickers** - è·å–Pickerå¸‚åœºåˆ—è¡¨
6. **GET /api/pickers/{picker_id}** - è·å–Pickerè¯¦æƒ…
7. **GET /download** - æ–‡ä»¶ä¸‹è½½

#### å—ä¿æŠ¤è·¯ç”± (5ä¸ª)
8. **GET /api/users/profile** - è·å–ç”¨æˆ·èµ„æ–™
9. **POST /api/pickers** - ä¸Šä¼ Picker
10. **POST /api/orders** - åˆ›å»ºè®¢å•
11. **GET /api/orders** - è·å–ç”¨æˆ·è®¢å•åˆ—è¡¨
12. **GET /api/orders/{order_id}** - è·å–è®¢å•è¯¦æƒ…

## è®¿é—®æ–¹å¼

### Swagger UI ç•Œé¢
å¯åŠ¨æœåŠ¡å™¨åï¼Œè®¿é—®ä»¥ä¸‹åœ°å€æŸ¥çœ‹äº¤äº’å¼ API æ–‡æ¡£ï¼š
```
http://localhost:3000/swagger-ui
```

### OpenAPI JSON è§„èŒƒ
è·å–å®Œæ•´çš„ OpenAPI 3.0 JSON è§„èŒƒï¼š
```
http://localhost:3000/api-docs/openapi.json
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
cd server
cargo run
```

### 2. è®¿é—® Swagger UI
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:3000/swagger-ui`

### 3. æµ‹è¯• API
- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„ API ç«¯ç‚¹
- æŸ¥çœ‹è¯·æ±‚/å“åº”æ¨¡å¼
- ç›´æ¥åœ¨ç•Œé¢ä¸­æµ‹è¯• API è°ƒç”¨
- æŸ¥çœ‹ç¤ºä¾‹è¯·æ±‚å’Œå“åº”

### 4. èº«ä»½éªŒè¯
å¯¹äºéœ€è¦èº«ä»½éªŒè¯çš„ç«¯ç‚¹ï¼š
1. é¦–å…ˆè°ƒç”¨ `/api/users/login` è·å– JWT token
2. ç‚¹å‡» Swagger UI å³ä¸Šè§’çš„ "Authorize" æŒ‰é’®
3. è¾“å…¥ `Bearer <your-jwt-token>`
4. ç°åœ¨å¯ä»¥æµ‹è¯•å—ä¿æŠ¤çš„ç«¯ç‚¹

## æŠ€æœ¯å®ç°

### ä¾èµ–é¡¹
```toml
[dependencies]
utoipa = { version = "4.0", features = ["axum_extras", "chrono", "uuid"] }
utoipa-swagger-ui = { version = "4.0", features = ["axum"] }
```

### æ ¸å¿ƒç»„ä»¶

#### 1. OpenAPI è§„èŒƒå®šä¹‰
- ä½ç½®: `src/openapi.rs`
- åŒ…å«å®Œæ•´çš„ API æ–‡æ¡£å®šä¹‰
- è‡ªåŠ¨ç”Ÿæˆçš„æ¨¡å¼å®šä¹‰

#### 2. è·¯ç”±æ³¨è§£
æ¯ä¸ªå¤„ç†å‡½æ•°éƒ½æ·»åŠ äº† `#[utoipa::path(...)]` æ³¨è§£ï¼ŒåŒ…å«ï¼š
- è·¯å¾„å’Œ HTTP æ–¹æ³•
- è¯·æ±‚/å“åº”æ¨¡å¼
- å‚æ•°æè¿°
- é”™è¯¯å“åº”
- å®‰å…¨è¦æ±‚

#### 3. æ¨¡å¼å®šä¹‰
ä¸ºæ‰€æœ‰æ•°æ®ç»“æ„å®ç°äº† `ToSchema` traitï¼š
- è¯·æ±‚ç»“æ„ä½“ (RegisterRequest, LoginRequest ç­‰)
- å“åº”ç»“æ„ä½“ (UserInfo, PickerInfo ç­‰)
- æšä¸¾ç±»å‹ (UserType, PayType, OrderStatus)

## æ–‡æ¡£ç‰¹æ€§

### ğŸ“‹ å®Œæ•´çš„æ¨¡å¼å®šä¹‰
- æ‰€æœ‰è¯·æ±‚å’Œå“åº”ç»“æ„çš„è¯¦ç»†æ¨¡å¼
- å­—æ®µç±»å‹ã€æ ¼å¼å’Œçº¦æŸ
- ç¤ºä¾‹å€¼å’Œæè¿°

### ğŸ” å®‰å…¨é…ç½®
- JWT Bearer token è®¤è¯
- å—ä¿æŠ¤ç«¯ç‚¹çš„å®‰å…¨è¦æ±‚
- æ¸…æ™°çš„è®¤è¯æµç¨‹è¯´æ˜

### ğŸ·ï¸ æ ‡ç­¾åˆ†ç»„
API æŒ‰åŠŸèƒ½åˆ†ç»„ï¼š
- `health` - å¥åº·æ£€æŸ¥
- `users` - ç”¨æˆ·ç®¡ç†
- `pickers` - Pickerç®¡ç†
- `orders` - è®¢å•ç®¡ç†
- `download` - æ–‡ä»¶ä¸‹è½½

### ğŸ“ è¯¦ç»†æè¿°
- æ¯ä¸ªç«¯ç‚¹çš„è¯¦ç»†æè¿°
- å‚æ•°è¯´æ˜å’Œç¤ºä¾‹
- é”™è¯¯ä»£ç å’Œæ¶ˆæ¯
- ä½¿ç”¨åœºæ™¯è¯´æ˜

## æµ‹è¯•å·¥å…·

### éªŒè¯ OpenAPI è§„èŒƒ
è¿è¡Œæµ‹è¯•å·¥å…·éªŒè¯è§„èŒƒç”Ÿæˆï¼š
```bash
cargo run --bin swagger_test
```

### ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç 
å¯ä»¥ä½¿ç”¨ OpenAPI è§„èŒƒç”Ÿæˆå„ç§è¯­è¨€çš„å®¢æˆ·ç«¯ä»£ç ï¼š
```bash
# ä½¿ç”¨ openapi-generator
openapi-generator generate -i http://localhost:3000/api-docs/openapi.json -g typescript-axios -o ./client
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

1. **åˆ›å»ºå¤„ç†å‡½æ•°**å¹¶æ·»åŠ  `#[utoipa::path(...)]` æ³¨è§£
2. **å®šä¹‰è¯·æ±‚/å“åº”ç»“æ„ä½“**å¹¶å®ç° `ToSchema`
3. **æ›´æ–° OpenAPI è§„èŒƒ**åœ¨ `openapi.rs` ä¸­æ·»åŠ è·¯å¾„å’Œç»„ä»¶
4. **æ·»åŠ è·¯ç”±**åˆ° `handlers/mod.rs`

### ç¤ºä¾‹ï¼šæ·»åŠ æ–°ç«¯ç‚¹
```rust
#[utoipa::path(
    post,
    path = "/api/new-endpoint",
    tag = "new",
    summary = "æ–°ç«¯ç‚¹",
    description = "æ–°ç«¯ç‚¹çš„æè¿°",
    request_body = NewRequest,
    responses(
        (status = 200, description = "æˆåŠŸ", body = NewResponse),
        (status = 400, description = "é”™è¯¯", body = ErrorResponse)
    )
)]
pub async fn new_endpoint(
    Json(payload): Json<NewRequest>,
) -> Result<Json<NewResponse>, AppError> {
    // å®ç°é€»è¾‘
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Swagger UI æ— æ³•åŠ è½½**
   - æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
   - ç¡®è®¤ç«¯å£ 3000 æœªè¢«å ç”¨

2. **OpenAPI è§„èŒƒç”Ÿæˆå¤±è´¥**
   - æ£€æŸ¥æ‰€æœ‰ç»“æ„ä½“æ˜¯å¦å®ç°äº† `ToSchema`
   - ç¡®è®¤è·¯å¾„æ³¨è§£è¯­æ³•æ­£ç¡®

3. **è®¤è¯æµ‹è¯•å¤±è´¥**
   - ç¡®ä¿ JWT token æ ¼å¼æ­£ç¡® (`Bearer <token>`)
   - æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹ç”Ÿæˆçš„è§„èŒƒ**
   ```bash
   curl http://localhost:3000/api-docs/openapi.json | jq
   ```

2. **éªŒè¯æ¨¡å¼å®šä¹‰**
   ```bash
   cargo run --bin swagger_test
   ```

## æœ€ä½³å®è·µ

1. **ä¿æŒæ–‡æ¡£åŒæ­¥** - ä¿®æ”¹ API æ—¶åŒæ—¶æ›´æ–°æ–‡æ¡£æ³¨è§£
2. **æä¾›ç¤ºä¾‹** - ä¸ºå¤æ‚çš„è¯·æ±‚/å“åº”æä¾›ç¤ºä¾‹å€¼
3. **è¯¦ç»†æè¿°** - ä¸ºæ¯ä¸ªç«¯ç‚¹æä¾›æ¸…æ™°çš„æè¿°å’Œä½¿ç”¨åœºæ™¯
4. **é”™è¯¯å¤„ç†** - æ–‡æ¡£åŒ–æ‰€æœ‰å¯èƒ½çš„é”™è¯¯å“åº”
5. **ç‰ˆæœ¬ç®¡ç†** - åœ¨é‡å¤§æ›´æ”¹æ—¶æ›´æ–° API ç‰ˆæœ¬

## æ€»ç»“

é€šè¿‡é›†æˆ Swagger OpenAPIï¼Œæœ¬é¡¹ç›®ç°åœ¨æä¾›ï¼š
- ğŸ“š å®Œæ•´çš„äº¤äº’å¼ API æ–‡æ¡£
- ğŸ§ª å†…ç½®çš„ API æµ‹è¯•å·¥å…·
- ğŸ”„ è‡ªåŠ¨åŒæ­¥çš„æ–‡æ¡£å’Œä»£ç 
- ğŸŒ æ ‡å‡†åŒ–çš„ API è§„èŒƒ
- ğŸ› ï¸ å®¢æˆ·ç«¯ä»£ç ç”Ÿæˆæ”¯æŒ

è¿™å¤§å¤§æé«˜äº† API çš„å¯ç”¨æ€§å’Œå¼€å‘æ•ˆç‡ï¼